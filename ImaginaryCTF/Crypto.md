# Relatively Small Arguments

## Description 

Last challenge before the big CTF! Bog-standard RSA, but I made some of the numbers smaller, just for slightly faster calculation.

## Attachments

We are given the source code `rsa.py`

```
#!/usr/bin/env python3

from Crypto.Util.number import *

p = getPrime(512)
q = getPrime(512)
n = p*q
phi = (p-1)*(q-1)
d = getPrime(32)
e = pow(d, -1, phi)
m = bytes_to_long(open('flag.txt', 'rb').read())
c = pow(m, e, n)

print(f'{n = }')
print(f'{e = }')
print(f'{c = }')

'''
n = 134872711253918655399533296784203466697159038260837702891888089821702090938512308686613559851138816682269099219724900870388583883202954112422023894133671598222066489215524613014212242490437041258588247678792591072443719118562580052842727775772283919113007499992167089258075609504428713653013187230671841726369
e = 50920242742169837294267124730818234703309561711363177522992049271988492365017092545331352650316729342598781520444569769450329777448285534584484096179230968844630486688656705514759778561817709539781927624692111848722199024819005269510690240743887870339853351421726436719236180272680237157536332997570569192069
c = 133155317855020316110137499609990113815646625767974277474197900721563685454745247616867035013963212538345727281661922602291072931578581035070345294335733120033652413487827994383327148598029065495228796201084369245315585407592741900307825557286213370482646401885352854920924352919398804532780740979273692054391
'''
```

## Solution

This RSA implementation is using a private key of 32 bits which is so small as compred to $\frac{1}{3}N^{\frac{1}{4}}$.
Because of that this implementation is vulnerable to [Weiner's Attack](https://en.wikipedia.org/wiki/Wiener%27s_attack).

I have used my [script](https://github.com/TheAlpha16/Tools/blob/main/RSA/Weiner's%20Attack.py) to get the flag.

## flag

`ictf{have_fun_at_ICTF_22!!!_559543c1}`

<br>

# Rotating Secret Assembler

## Description

Last challenge before the big CTF! Bog-standard RSA, but I made some of the numbers smaller, just for slightly faster calculation.

## Attachments

`nc puzzler7.imaginaryctf.org 3000`

source code

```
#!/usr/bin/env python3

from Crypto.Util.number import *

class Rotator:
    QUEUE_LENGTH = 10

    def __init__(self):
        self.e = 65537
        self.m = bytes_to_long(open('flag.txt', 'rb').read())
        self.queue = [getPrime(512) for i in range(self.QUEUE_LENGTH)]

    def get_new_primes(self):
        ret = self.queue[-2:]
        self.queue.pop()
        while(len(self.queue) < self.QUEUE_LENGTH):
            self.queue = [getPrime(512)] + self.queue
        return tuple(ret)

    def enc_flag(self):
        p, q = self.get_new_primes()
        n = p*q
        print(f"Public key: {(n, self.e)}")
        print(f"Your encrypted flag: {pow(self.m, self.e, n)}")

rot = Rotator()

print('='*80)
print(open(__file__).read())
print('='*80)

while True:
    inp = input("Would you like an encrypted flag (y/n)? ")
    if 'y' in inp.lower():
        rot.enc_flag()
        print()
    else:
        break
```

## Solution

The script shows that at initializion, there is a list of 10 512 bit prime numbers.

In each iteration the last two primes are being used to encrypt the flag using RSA.
After that the last prime is being popped and a new prime is being added at the start reinitializing the list.

Here one of the primes in two consecutive requests is same.

So we can take [gcd](https://en.wikipedia.org/wiki/Greatest_common_divisor) of the two consecutive N values to get one prime.

Using one prime we get the other prime, private key, thereby flag.

## flag

`ictf{why_would_I_throw_away_perfectly_good_primes?}`

<br>

# Enormous

## Description

I hear that more bits of security is better, so I'm using MASSIVE primes, and a TON of them! I bet you can't recover my flag now...

## Attachments

We are provided with source code and output.

`source code`

```
#!/usr/bin/env python3

from Crypto.Util.number import *

m = bytes_to_long(open('flag.txt', 'rb').read())

n = 1
for i in range(5):
    n *= getPrime(2025)

e = 31
c = pow(m, e, n)

print(f'{n = }')
print(f'{c = }')
```

`output`

```
n = 291803461471835548029967773522617765771350293869936352202474825278720037203079126582761195517055393337441548702117740296881683037727672928813574338546415946481976583248116652581196557944379208515379849557208903959136881415277929278949854798024237931268890091008477560536810024512885987056365875451976655685041061567307476564581225633751629621363138947815696306121690184995538414167930734015725366640439645369938523746682075126307100603220423134559397115857296708492139355989095937406415073168747479949371092134873701556328545495456400479495405193756279972004658782475408189585025641505819277077925673695334900236713191922331469670007945415879984668758786665610223439789798214375546410680980683442235218021025215976372242754132940477478408728993116985028306733912194477013321051867704500024616342520287838575375839552875084135772432229149413294380432533743143268579060594509980073144254923676380538357838797628476519470503636727538392293326221896054673794948778257952143474326337234955144876478098752630600927746134626196808185237724150959895921700993985671689787276218491977409950443800149225682113795630552332504004952619477399053219103742133837193866168480669953649964494066888017534621349322438584844756384881305359216958596115238052386689420189458226861633978864646432620132110836770754297086384562270853072519298962385476479869301761383621785222318621201306854098202131486922131567300293859330130962769515935517026489631422656886068186229630258223006684833047809688321362843298049850048526302305175457080852712874501906848203834687269452532674672111135077303202528935822816608612547229714776677161298357980007749334544698155455911782984751127779599045510344930085038624054982145201414246233123815597579302583147041169085302625820240543206702814039468429064024961160403696288636475388432798179348622575416616596660498584921414806447533272237263496191108268914962604350759322278134843256344477715665697069507629272092477112527371006313935780156040584212958154549663363234981080730341044630508652240837192014074955790169192194298119435104568924354781734446534914749601480158889645876224737439717511154355206076336705115742763304668954084456504898364386765064143296380474352710379369338692522064891115596552538797109330579251735034330969865851105628851397031731926651793499033360226446821843504185544154328716719785183357806999155047816431736359882490550923048419234555352161279478407242984715707163307294861304711709346203477359865199980901678783907976621786706266847296286119737497401164377524189197707568924565911584058570117345183256470833488981286971331095107229945553900124115789585129411526064683438180406246914918344456337671900934740227313729020212681061906134397379053692184471039837008926116046967034965277671872122518335972888506407864660599133420704405557724318002121940379059800231596103401873109461507047985158261487833687090154196870319427268386336264078936523908731859981832206513441924170577885564684644417486126018121796087385930741681311819019125337235246299198151106436637821460451583430819222542798910970466234016929862844811
c = 226930369324008404506430665129822599607363575603852919162120583266060503841096845215449850837542305149561600338927114119661251460696499327139957176529329816529721270191210916244477856685216908277164786965592514696226839914244875659319076517558315356771625419496558856490589162500644071477833930756663564789474118682399930460441453389184243891216077282099093040608309336018996001999607804378777688916461360425788926205328424150096034051909616660195338367962715944075422262015953517413557051762509103453392458978208273498438562590307215849951642965795004794034627510875473381435541017212698396608282069420063879979294704473018597265098131904018063045638336304539514249356120536639126440406176682131920666202709416873040296025545675588170167188101050321143515763604977360112398853875935854811777919563324598193504991150103686515910286033304218405898596673422366231606745906059933502082246405148016608529329647781881278472976090154368272290761619490459310416194216982004034487788734832367018517887748097898401525507381806366491661667977442619626223736995461937920878273486909559233659993985592623485669719325763874250803422121180632196849036588606681806804779542977650673644965059641304478487892054477356779339273971259597178303031111140283501709064199430436811542668710546345343441829103999774652299936885473523503009793950905394505839067527152330406049376043739899459809162044962915696399547788486686478589032533842260339084289115269117632962020418999678475193626806742925843561762423017088328632995430074096317560695952243685718370993439935920576217955150699936307124819436288798249076737597129112939696691564055039464675485835224015600323880336127740300585706502138276566411354270875449815373574454780958012435380709513462476775660322560648809380299392885568074034592363611854633574329130489038883130308557866650522882369513797748667234932757559604717587488355500387902038121779580165322861111064918787012060293221646897837406810365496082480818926712329359069411884747738664835433270202960934930293501624299923646957173316725913900452048522962309107483401916982942273644258253234270266404355705906353284060421906451579547553536945596143114182089674169040390233403896259650990843716723248382763373947627940237097774346467516704409787940216547116621556170101766022005778473958237584851951344954861454573678221816288918395713861770977183669035942556070546761545743731295074496369509049235313470403093920087296483871093325318582310743131764728865964884228088025170409263061963059341395163695331110078909587683201275928829278515137618074138615962652765840849275249482071226860249873486273492767754112528529082909363770315076153401338000909130399064593162194239842969972233531547178659983688101566357539063657007915493318885261560981584227020995472033268237671253586876466785624983819848898009727296036477735934655396784185145970437264598583023149435320752783415451501056661506420824553646380553999069539369921607338465904854175989857439546309918605715931884872868486467592929171204176835962074595013700782437300593834359405047404582902352876008272897313

```

## Solution

In this implementation, N is so large and e is small.

This means $M^{e}$ is comparable to N.

So we can bruteforce the flag.

```
from Crypto.Util.number import *
from sympy import integer_nthroot

n = 291803461...
c = 226930369...

def main(n1, n2):
    for i in range(n1, n2):
        try:
            print(long_to_bytes(integer_nthroot((i*n)+c, 31)[0]).decode())
            print(i)
        except UnicodeDecodeError:
            pass


if __name__ == '__main__':
    main(1, 100)
```

## flag

`ictf{d0nt_f0rget_t0_pad_y0ur_pl@intexts!}`

<br>

# AES

## Description

```
Python 3.8.10 (default, Mar 15 2022, 12:22:08)
[GCC 9.4.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> import random
>>> from Crypto.Cipher import AES
>>> key = random.choice(open("rockyou.txt", "rb").readlines()[:10000]).strip()
>>> key = key.zfill(16)
>>> cipher = AES.new(key, AES.MODE_ECB)
>>> cipher.encrypt(open("flag.txt", "rb").read().zfill(48))
b"\xd6\x19O\xbeA\xb0\x15\x87\x0e\xc7\xc4\xc1\xe9h\xd8\xe6\xc6\x95\x82\xaa#\x91\xdb2l\xfa\xf7\xe1C\xb8\x11\x04\x82p\xe5\x9e\xb1\x0c*\xcc[('\x0f\xcc\xa7W\xff"
```

## Attachments

None

## Solution

The above implementation is [aes](https://en.wikipedia.org/wiki/Advanced_Encryption_Standard) encryption with key as one of the first 10000 passwords in popular wordlist [rockyou.txt](https://github.com/brannondorsey/naive-hashcat/releases/download/data/rockyou.txt).

We can simply bruteforce the first 10000 passwords and get the flag.

The below script does the same.

```
from Crypto.Cipher import AES

enc = b"\xd6\x19O\xbeA\xb0\x15\x87\x0e\xc7\xc4\xc1\xe9h\xd8\xe6\xc6\x95\x82\xaa#\x91\xdb2l\xfa\xf7\xe1C\xb8\x11\x04\x82p\xe5\x9e\xb1\x0c*\xcc[('\x0f\xcc\xa7W\xff"

with open('./rockyou.txt', 'rb') as key_list:
    keys = key_list.readlines()[:10000]


def main(key):
    key = key.strip()
    key = key.zfill(16)
    cipher = AES.new(key, AES.MODE_ECB)
    decrypted = cipher.decrypt(enc)
    return decrypted


final = ''

for i in range(len(keys)):
    try:
        flag = main(keys[i])
        print(flag.decode())
    except ValueError:
        pass
```

## flag

`ictf{d0nt_us3_w3ak_k3ys!!!!}`

<br>

# Personalized

## Description

I found this place that just hands out flags! The only problem is that they're all encrypted, tailored to you, personally. Can you decrypt it?

## Attachments

enc.py

```
#!/usr/bin/env python3

from Crypto.Util.number import *
from random import seed, getrandbits

m = bytes_to_long(open('flag.txt', 'rb').read())
print("What's your name?\n>>> ", end='')
name = open(0, 'rb').readline().strip()
seed(bytes_to_long(name))
e = 2*getrandbits(32)+1
p = getPrime(512)
q = getPrime(512)
n = p*q
c = pow(m, e, n)
print(f"Here's your flag, {''.join(chr(i) for i in name)}!")
print(f'{n = }')
print(f'{e = }')
print(f'{c = }')
```

`nc puzzler7.imaginaryctf.org 4002`


## Solution 

The script takes a string from user and uses it as the seed.
In a way, we can actually control the value of e.

So, the initial thought was to make e as small as possible. The minimum that we can achieve is 1.

For that we need a seed that produces zero when we use `getrandbits(32)`.

After bruteforcing for about 6 hours, the seed that produces 0 is `4213973159`.

script

```
import socket
from Crypto.Util.number import *


def netcat(hostname, port):
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((hostname, port))

    s.recv(1024)
    payload = long_to_bytes(4213973159)
    print(payload)
    s.sendall(payload+b'\n')
    data2 = s.recv(1024)
    index = data2.find(b'c = ')
    flag_int = int(data2[index+4:-1].decode())
    print(long_to_bytes(flag_int).decode())


host = "puzzler7.imaginaryctf.org"
port = 4002

netcat(host, port)
```

## flag

`ictf{just_f0r_y0uuuuuuuu}`

<br>

# Same

## Description

Something here is the same...

## Attachments

same.py

```
from Crypto.Util.number import getPrime, bytes_to_long
m = bytes_to_long(open("flag", "rb").read())
n = getPrime(512)*getPrime(512)
e = [1337,31337]
print(n)
print(pow(m,e[0],n))
print(pow(m,e[1],n))
```

output.txt

```
88627598925887227793409704066287679810103408445903546693879278352563489802835708613718629728355698762251810901364530308365201192197988674078034209878433048946797619290221501750862580914894979204943093716650072734138749420932619469204815802746273252727013183568196402223549961607284086898768583604510696483111
45254947860172381004009381991735702721210786277711531577381599020185600496787746985669891424940792336396574951744089759764874889285927022268694128526139687661305707984329995359802337446670063047702309778972385903473896687843125261988493615328641864610786785749566148338268077425756876069789788618208807001704
16054811947596452078263236160429328686151351092304509270058479526590947874445940946506791900760052230887962479603369427120610506778471930164144528718052332194666418267005043709704814833963217926271924910466448499814399455203725279998913865531351070938872586642424346857094632491904168889134624707595846754719
```

## Solution

The flaw in the above implementation is that both encryptions are using same modulus.

This allows us to do [Common Modulus Attack](https://infosecwriteups.com/rsa-attacks-common-modulus-7bdb34f331a5)

script

```
from Crypto.Util.number import *
from math import gcd


def egcd(a, b):
    if a == 0:
        return b, 0, 1
    else:
        g, y, x = egcd(b % a, a)
        return g, x - (b // a) * y, y


def attack(c1, c2, e1, e2, N):
    g, x, y = egcd(e1, e2)
    m1 = pow(c1, x, N)
    m2 = pow(c2, y, N)
    flag = (m1 * m2) % N
    print(long_to_bytes(flag).decode())


 n = 886275989258872277...
c1 = 452549478601723810...
c2 = 160548119475964520...
e1 = 1337
e2 = 31337

attack(c1, c2, e1, e2, n)
```

## flag

`ictf{n3ver_r3use_m0dul1}`

<br>
